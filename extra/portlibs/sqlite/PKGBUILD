pkgname=switch-sqlite
pkgver=3.7.3
pkgrel=1
pkgdesc='SQLite 3 library'
arch=('any')
url='https://www.sqlite.org/'
license=('Public Domain')
source=(
  sqlite-amalgamation-3.7.3.tar.gz
  sqlite3.patch
  mmap.patch
)
sha256sums=('3186631378474575dd766f46583219903db2b26af1f78cb15318e79c227a0080'
            '5b94b36bbccd0656799026d9129fe07f638052d33666f40913e716ade812c32e'
            '590499441894443d5509c904a903ad4d00b65bc8c6fac0a7220f26a8821f44d5')
makedepends=('git' 'switch-pkg-config')
groups=('switch-portlibs')

build() {
  cd "sqlite-3.7.3/"

  patch -Np1 -i $srcdir/sqlite3.patch
  patch -Np1 -i $srcdir/mmap.patch
  
  source ${DEVKITPRO}/switchvars.sh
  export CFLAGS="$CFLAGS -DSQLITE_DEBUG"
  ./configure --prefix="${PORTLIBS_PREFIX}" --disable-dynamic-extensions --disable-threadsafe --disable-libtool-lock --enable-static --disable-largefile --host=arm-noeabi-elf

  make libsqlite3.la
}

package() {
  cd "sqlite-3.7.3/"
  
  make DESTDIR="$pkgdir" install-libLTLIBRARIES
  make DESTDIR="$pkgdir" install-data-am
  
}
